{% extends "base.html" %}

{% block title %}Dashboard{% endblock %}

{% block content %}
<div class="container">
    <h1>Welcome to Your Dashboard</h1>
    <div id="accountInfo" class="alert alert-info">Fetching account details...</div>

    <h2>Actions</h2>
    <ul id="actionLinks" style="display: none;">
        <li><a id="fundAccountLink" href="#">Fund Your Account</a></li>
        <li><a id="startTradingLink" href="#">Start Trading</a></li>
        <li><a id="viewAccountDetailsLink" href="#">View Account Details</a></li>
    </ul>
</div>

<script>
    async function fetchAccountDetails() {
        console.log("Debug: Fetching account details from the backend.");
        const accountInfoElement = document.getElementById('accountInfo');
        const actionLinksElement = document.getElementById('actionLinks');

        try {
            const response = await fetch('/api/accounts');  // Replace with the correct API endpoint
            if (response.ok) {
                const account = await response.json();
                console.log("Debug: Successfully fetched account details:", account);

                accountInfoElement.classList.remove('alert-info');
                accountInfoElement.classList.add('alert-success');
                accountInfoElement.innerHTML = `
                    <p><strong>Account Number:</strong> ${account.account_number}</p>
                    <p><strong>Status:</strong> ${account.status}</p>
                    <p><strong>Currency:</strong> ${account.currency}</p>
                    <p><strong>Created At:</strong> ${new Date(account.created_at).toLocaleString()}</p>
                `;

                // Enable action links
                document.getElementById('fundAccountLink').href = `/fund-account?account_id=${account.account_number}`;
                document.getElementById('startTradingLink').href = `/trading?account_id=${account.account_number}`;
                document.getElementById('viewAccountDetailsLink').href = `/account-details?account_id=${account.account_number}`;
                actionLinksElement.style.display = 'block';
            } else {
                console.error("Debug: Failed to fetch account details. Response:", response);
                accountInfoElement.classList.remove('alert-info');
                accountInfoElement.classList.add('alert-danger');
                accountInfoElement.textContent = 'Failed to fetch account details. Please try again later.';
            }
        } catch (error) {
            console.error("Debug: Error fetching account details:", error);
            accountInfoElement.classList.remove('alert-info');
            accountInfoElement.classList.add('alert-danger');
            accountInfoElement.textContent = 'An error occurred while fetching account details.';
        }
    }

    // Fetch account details on page load
    fetchAccountDetails();
</script>

{% endblock %}
