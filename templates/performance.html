{% extends "base.html" %}

{% block title %}Performance{% endblock %}

{% block content %}
    <h1>Portfolio Performance compared to S&P 500 & NASDAQ-100 (Base Index 100)</h1>
    <br>
    <!-- Display Annualized Return -->
    <div>
        <h4>Annualized Return</h4>
        <h5>Portfolio: <span id="annualizedReturn">-</span>%</h5>
        <h5>S&P 500: <span id="sp500AnnualizedReturn">-</span>%</h5>
        <h5>NASDAQ-100: <span id="nasdaq100AnnualizedReturn">-</span>%</h5>
    </div>
    <br>
    <!-- Time Filter Buttons -->
    <div>
        <button class="btn btn-primary" onclick="filterData('10years')">Last 10 Years</button>
        <button class="btn btn-primary" onclick="filterData('3years')">Last 3 Years</button>
        <button class="btn btn-primary" onclick="filterData('12months')">Last 12 Months</button>
    </div>
    <br>
    <!-- Chart.js Canvas -->
    <canvas id="simulationPerformanceChart"></canvas>

<script>
    function filterData(period) {
        const fullDates = {{ dates_simulation | tojson | safe }};
        const fullPortfolioValues = {{ simulation_values | tojson | safe }};
        const fullSp500Values = {{ sp500_values_simulation | tojson | safe }};
        const fullNasdaq100Values = {{ nasdaq100_values_simulation | tojson | safe }};

        const filteredDates = [];
        const filteredPortfolioValues = [];
        const filteredSp500Values = [];
        const filteredNasdaq100Values = [];

        for (let i = 0; i < fullDates.length; i++) {
            filteredDates.push(fullDates[i]);
            filteredPortfolioValues.push(fullPortfolioValues[i]);
            filteredSp500Values.push(fullSp500Values[i]);
            filteredNasdaq100Values.push(fullNasdaq100Values[i]);
        }

        updateChart(filteredDates, filteredPortfolioValues, filteredSp500Values, filteredNasdaq100Values);
    }

    function updateChart(dates, portfolioValues, sp500Values, nasdaq100Values) {
        const ctx = document.getElementById('simulationPerformanceChart').getContext('2d');

        if (chart) {
            chart.destroy();
        }

        chart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: dates,
                datasets: [
                    {
                        label: 'Portfolio (Base Index 100)',
                        data: portfolioValues,
                        borderColor: 'rgba(75, 192, 192, 1)',
                        borderWidth: 2,
                        fill: false
                    },
                    {
                        label: 'S&P 500 (Base Index 100)',
                        data: sp500Values,
                        borderColor: 'rgba(255, 99, 132, 1)',
                        borderWidth: 2,
                        fill: false
                    },
                    {
                        label: 'NASDAQ-100 (Base Index 100)',
                        data: nasdaq100Values,
                        borderColor: 'rgba(54, 162, 235, 1)',
                        borderWidth: 2,
                        fill: false
                    }
                ]
            }
        });
    }

    document.addEventListener('DOMContentLoaded', function () {
        filterData('10years');
    });
</script>

{% endblock %}
