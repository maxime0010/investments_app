{% extends "base.html" %}

{% block content %}
    <h1>Portfolio Performance (Base Index 100)</h1>

    <!-- Actual Performance Graph -->
    <div>
        <h3>Actual Performance (Base Index 100)</h3>
        <canvas id="actualPerformanceChart"></canvas>
    </div>

    <!-- Simulation-Based Performance Graph -->
    <div>
        <h3>Simulation-Based Performance (Base Index 100)</h3>
        <canvas id="simulationPerformanceChart"></canvas>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Function to normalize data to base index 100
        function normalizeData(data) {
            var baseValue = data[0];
            return data.map(function(value) {
                return (value / baseValue) * 100;
            });
        }

        // Actual portfolio and S&P500 data
        var actualPortfolioData = normalizeData({{ actual_values | tojson }});
        var sp500DataActual = normalizeData({{ sp500_values_actual | tojson }});
        var datesActual = {{ dates_actual | tojson }};

        // Simulated portfolio and S&P500 data
        var simulatedPortfolioData = normalizeData({{ simulation_values | tojson }});
        var sp500DataSimulation = normalizeData({{ sp500_values_simulation | tojson }});
        var datesSimulation = {{ dates_simulation | tojson }};

        // Create color gradients
        var ctxActual = document.getElementById('actualPerformanceChart').getContext('2d');
        var gradientActualPortfolio = ctxActual.createLinearGradient(0, 0, 0, 400);
        gradientActualPortfolio.addColorStop(0, 'rgba(75, 192, 192, 0.4)');
        gradientActualPortfolio.addColorStop(1, 'rgba(75, 192, 192, 0.0)');

        var gradientSP500Actual = ctxActual.createLinearGradient(0, 0, 0, 400);
        gradientSP500Actual.addColorStop(0, 'rgba(255, 99, 132, 0.4)');
        gradientSP500Actual.addColorStop(1, 'rgba(255, 99, 132, 0.0)');

        var ctxSimulation = document.getElementById('simulationPerformanceChart').getContext('2d');
        var gradientSimulatedPortfolio = ctxSimulation.createLinearGradient(0, 0, 0, 400);
        gradientSimulatedPortfolio.addColorStop(0, 'rgba(54, 162, 235, 0.4)');
        gradientSimulatedPortfolio.addColorStop(1, 'rgba(54, 162, 235, 0.0)');

        var gradientSP500Simulation = ctxSimulation.createLinearGradient(0, 0, 0, 400);
        gradientSP500Simulation.addColorStop(0, 'rgba(255, 99, 132, 0.4)');
        gradientSP500Simulation.addColorStop(1, 'rgba(255, 99, 132, 0.0)');

        // Minimalistic options (no grid lines)
        var minimalisticOptions = {
            scales: {
                x: {
                    grid: {
                        display: false  // No grid lines
                    },
                    ticks: {
                        autoSkip: true,
                        maxTicksLimit: 10
                    }
                },
                y: {
                    grid: {
                        display: false  // No grid lines
                    },
                    ticks: {
                        callback: function(value) {
                            return '$' + value.toFixed(2);  // Display values as currency
                        }
                    }
                }
            },
            elements: {
                line: {
                    tension: 0.4  // Smooth curves
                }
            },
            plugins: {
                legend: {
                    display: true,
                    position: 'bottom',
                    labels: {
                        font: {
                            size: 14
                        }
                    }
                },
                title: {
                    display: true,
                    text: 'Portfolio vs S&P 500 Performance (Base Index 100)',
                    font: {
                        size: 16,
                        style: 'bold'
                    }
                }
            },
            responsive: true,
            maintainAspectRatio: false
        };

        // Actual Performance Chart with smooth curves, gradients, and minimalistic design
        var actualPerformanceChart = new Chart(ctxActual, {
            type: 'line',
            data: {
                labels: datesActual,
                datasets: [
                    {
                        label: 'Actual Portfolio Value (Base Index 100)',
                        data: actualPortfolioData,
                        borderColor: 'rgba(75, 192, 192, 1)',
                        backgroundColor: gradientActualPortfolio,
                        borderWidth: 2,
                        fill: true  // Enable gradient fill
                    },
                    {
                        label: 'S&P 500 (Base Index 100)',
                        data: sp500DataActual,
                        borderColor: 'rgba(255, 99, 132, 1)',
                        backgroundColor: gradientSP500Actual,
                        borderWidth: 2,
                        fill: true  // Enable gradient fill
                    }
                ]
            },
            options: minimalisticOptions
        });

        // Simulation-Based Performance Chart with smooth curves, gradients, and minimalistic design
        var simulationPerformanceChart = new Chart(ctxSimulation, {
            type: 'line',
            data: {
                labels: datesSimulation,
                datasets: [
                    {
                        label: 'Simulated Portfolio Value (Base Index 100)',
                        data: simulatedPortfolioData,
                        borderColor: 'rgba(54, 162, 235, 1)',
                        backgroundColor: gradientSimulatedPortfolio,
                        borderWidth: 2,
                        fill: true  // Enable gradient fill
                    },
                    {
                        label: 'S&P 500 (Base Index 100)',
                        data: sp500DataSimulation,
                        borderColor: 'rgba(255, 99, 132, 1)',
                        backgroundColor: gradientSP500Simulation,
                        borderWidth: 2,
                        fill: true  // Enable gradient fill
                    }
                ]
            },
            options: minimalisticOptions
        });
    </script>
{% endblock %}
