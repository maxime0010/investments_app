{% extends "base.html" %}

{% block content %}
<div class="container my-5">
    <!-- Stock Title and Ticker -->
    <h1 class="display-4">{{ stock_name }} <small class="text-muted">({{ ticker }})</small></h1>
    
    <!-- Expected Return -->
    <div class="my-4">
        <h3>Expected Return:</h3>
        <p class="lead">{{ analysis_data.expected_return_combined_criteria }}%</p>
    </div>

    <!-- Investment Rationale -->
    <div class="my-4">
        <h3>Investment Rationale:</h3>
        
        <!-- Short Version -->
        <div class="card mb-3">
            <div class="card-header">
                <strong>Summary</strong>
            </div>
            <div class="card-body">
                <p class="card-text">{{ analysis_data.short_recommendation }}</p>
            </div>
        </div>
        
        <!-- Detailed Version -->
        <div class="card">
            <div class="card-header">
                <strong>Detailed Analysis</strong>
            </div>
            <div class="card-body">
                <p class="card-text">{{ analysis_data.long_recommendation }}</p>
            </div>
        </div>
    </div>

    <!-- Analysts Table -->
    <table class="table table-striped mt-4">
        <thead>
            <tr>
                <th scope="col">Analyst</th>
                <th scope="col">Bank</th>
                <th scope="col">Price Target</th>
                <th scope="col">Last Update</th>
                <th scope="col">Expected Return</th>
                <th scope="col">Success Rate</th>
                <th scope="col">Updated in the Last 30 Days</th>
                <th scope="col">Top Performer</th>
            </tr>
        </thead>
        <tbody>
            {% for analyst in analysts_data %}
            <tr class="{% if analyst.grey_out %}text-muted{% endif %}">
                <td>{{ analyst.analyst_name }}</td>
                <td>{{ analyst.bank }}</td>
                <td>${{ analyst.price_target | round(2) if analyst.price_target is not none else 'N/A' }}</td>
                <td>{{ analyst.last_update.strftime('%Y-%m-%d') }}</td>
                <td>{{ analyst.expected_return | round(2) if analyst.expected_return is not none else 'N/A' }}%</td>
                <td>{{ analyst.overall_success_rate | round(2) }}%</td>
                <td class="{% if analyst.updated_last_30_days == 'Yes' %}bg-success text-white{% endif %}">{{ analyst.updated_last_30_days }}</td>
                <td class="{% if analyst.is_top_performer == 'Yes' %}bg-success text-white{% endif %}">{{ analyst.is_top_performer }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}
