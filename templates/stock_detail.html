{% extends "base.html" %}

{% block content %}
<div class="container my-5">

    <!-- Section 1: Investment Recommendation -->
    <div class="box mb-5 p-4 shadow-lg">
        <h2 class="box-title mb-4">Investment Recommendation</h2>
        <div class="row">
            <div class="col-md-4 text-center">
                <div class="number-section">
                    <span class="highlighted-number">{{ analysis_data.last_closing_price }}</span>
                    <span class="number-description">Current Price</span>
                </div>
            </div>
            <div class="col-md-4 text-center">
                <div class="number-section">
                    <span class="highlighted-number">{{ analysis_data.avg_combined_criteria }}</span>
                    <span class="number-description">Price Target</span>
                </div>
            </div>
            <div class="col-md-4 text-center">
                <div class="number-section">
                    <span class="highlighted-number">{{ analysis_data.expected_return_combined_criteria }}%</span>
                    <span class="number-description">Expected Return</span>
                </div>
            </div>
        </div>
        <div class="text-center mt-4">
            {% if stock_in_portfolio %}
                <button class="btn btn-success btn-lg px-5">BUY</button>
            {% else %}
                <button class="btn btn-danger btn-lg px-5">SELL</button>
            {% endif %}
        </div>
    </div>

    <!-- Section 2: Strategic Rationale -->
    <div class="box mb-5 p-4 shadow-lg">
        <h2 class="box-title mb-4">Strategic Rationale</h2>
        <p>{{ analysis_data.long_recommendation }}</p>
    </div>

    <!-- Section 3: Company Analysis -->
    <div class="box mb-5 p-4 shadow-lg">
        <h2 class="box-title mb-4">Company Analysis</h2>
        <p>Content will be added here...</p>
    </div>

    <!-- Section 4: Analysts Ratings -->
    <div class="mb-5">
        <h2 class="mb-4">Analysts Ratings</h2>
        <div class="row">
            {% for analyst in analysts_data %}
            <div class="col-md-4 mb-4">
                <div class="box h-100 shadow">
                    <div class="box-body">
                        <h5 class="box-title">{{ analyst.analyst_name }}</h5>
                        <h6 class="box-subtitle mb-2 text-muted">{{ analyst.bank }}</h6>
                        <p class="box-text">Price Target: ${{ analyst.price_target | round(2) }}</p>
                        <p class="box-text">Expected Return: {{ analyst.expected_return | round(2) }}%</p>
                        <p class="box-text">Success Rate: {{ analyst.overall_success_rate | round(2) }}%</p>
                    </div>
                    <div class="box-footer text-center {% if analyst.updated_last_30_days == 'Yes' %}bg-success text-white{% else %}bg-light{% endif %}">
                        <small>{{ analyst.updated_last_30_days == 'Yes' ? "Updated Recently" : "Last Update: " ~ analyst.last_update.strftime('%Y-%m-%d') }}</small>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

</div>
{% endblock %}
